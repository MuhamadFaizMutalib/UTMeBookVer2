<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTMeBook - Place Order</title>
    <link rel="stylesheet" href="../webstyles/css/placeorder.css">
    <link rel="stylesheet" href="../webstyles/css/mobile-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="../webfunctions/placeOrderApp.js"></script>
</head>
<body ng-app="placeOrderApp" ng-controller="PlaceOrderController">
    <div class="place-order-container">
        <!-- Header -->
        <header class="header">
            <!-- Mobile Menu Toggle Button -->
            <button class="mobile-menu-toggle" ng-click="toggleMobileMenu()">
                <i class="fas" ng-class="{'fa-bars': !mobileMenuOpen, 'fa-times': mobileMenuOpen}"></i>
            </button>
            
            <div class="logo">
                <h1>UTMeBook</h1>
            </div>
            
            <div class="user-menu">
                <span class="username">{{ user.username }}</span>
                <button class="btn-logout" ng-click="logout()">Logout</button>
            </div>
        </header>
        
        <!-- Navigation Bar -->
        <nav class="navbar">
            <ul ng-class="{'show-mobile': mobileMenuOpen}">
                <li>
                    <a href="#" ng-click="setActiveTab('add-ebook')">
                        <i class="fas fa-plus-circle"></i> Add eBook
                    </a>
                </li>
                <li>
                    <a href="#" ng-click="setActiveTab('order')">
                        <i class="fas fa-clipboard-list"></i> Order
                    </a>
                </li>
                <li>
                    <a href="#" ng-click="setActiveTab('messages')">
                        <i class="fas fa-envelope"></i> Messages
                    </a>
                </li>
                <li>
                    <a href="#" ng-click="setActiveTab('mybook')">
                        <i class="fas fa-book"></i> MyBook
                    </a>
                </li>
                <li>
                    <a href="#" ng-click="setActiveTab('account')">
                        <i class="fas fa-user"></i> Account
                    </a>
                </li>
                <li>
                    <a href="#" ng-click="setActiveTab('dashboard')">
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- Order Details Section -->
        <section class="order-details-section">
            <h2 class="section-title">Place Order</h2>
            
            <!-- Test Mode Banner (only visible when testMode is true) -->
            <div class="test-mode-banner" ng-if="testMode">
                <i class="fas fa-flask"></i> Test Mode: No actual payment will be processed
            </div>
            
            <div class="book-details-card">
                <div class="book-cover">
                    <img ng-src="{{ book.coverUrl }}" alt="{{ book.title }}">
                </div>
                <div class="book-info">
                    <h3>{{ book.title }}</h3>
                    <p class="seller">Seller: {{ book.sellerName }}</p>
                    <p class="price">RM{{ book.price.toFixed(2) }}</p>
                    <p class="upload-date">Upload Date: {{ book.uploadDate | date:'mediumDate' }}</p>
                    <p class="description">{{ book.description }}</p>
                </div>
            </div>
            
            <!-- Payment Method Section -->
            <div class="payment-section">
                <h3>Payment Method</h3>
                
                <!-- Payment Method Selection -->
                <div class="payment-method-selection">
                    <label class="payment-option" ng-class="{'selected': selectedPaymentMethod === 'stripe'}">
                        <input type="radio" name="paymentMethod" value="stripe" 
                               ng-model="selectedPaymentMethod" 
                               ng-change="changePaymentMethod('stripe')">
                        <span class="payment-label">
                            <i class="fas fa-credit-card"></i> Credit Card / Online Banking (Stripe)
                        </span>
                    </label>
                    
                    <label class="payment-option" ng-class="{'selected': selectedPaymentMethod === 'bank_transfer'}">
                        <input type="radio" name="paymentMethod" value="bank_transfer" 
                               ng-model="selectedPaymentMethod"
                               ng-change="changePaymentMethod('bank_transfer')">
                        <span class="payment-label">
                            <i class="fas fa-university"></i> Manual Bank Transfer
                        </span>
                    </label>
                    
                    <label class="payment-option" ng-class="{'selected': selectedPaymentMethod === 'ewallet'}">
                        <input type="radio" name="paymentMethod" value="ewallet" 
                               ng-model="selectedPaymentMethod"
                               ng-change="changePaymentMethod('ewallet')">
                        <span class="payment-label">
                            <i class="fas fa-wallet"></i> E-Wallet
                        </span>
                    </label>
                </div>
                
                <!-- Stripe Payment Element (only shown when stripe is selected) -->
                <div class="payment-details" ng-if="selectedPaymentMethod === 'stripe'">
                    <div id="stripe-payment-element" class="stripe-element-container">
                        <!-- Stripe Elements will be inserted here -->
                    </div>
                    <div class="card-errors" role="alert"></div>
                </div>
                
                <!-- Manual Bank Transfer Instructions (only shown when bank_transfer is selected) -->
                <div class="payment-details" ng-if="selectedPaymentMethod === 'bank_transfer'">
                    <div class="bank-info">
                        <h4>Bank Transfer Details</h4>
                        <p><strong>Bank:</strong> Maybank</p>
                        <p><strong>Account Name:</strong> UTMeBook Sdn Bhd</p>
                        <p><strong>Account Number:</strong> 1234 5678 9012</p>
                        <p class="payment-note">Please include your username and book title in the transfer reference</p>
                    </div>
                </div>
                
                <!-- E-wallet Instructions (only shown when ewallet is selected) -->
                <div class="payment-details" ng-if="selectedPaymentMethod === 'ewallet'">
                    <div class="ewallet-info">
                        <h4>E-Wallet Payment</h4>
                        <div class="ewallet-options">
                            <div class="ewallet-option">
                                <i class="fas fa-qrcode"></i>
                                <p>Boost</p>
                            </div>
                            <div class="ewallet-option">
                                <i class="fas fa-qrcode"></i>
                                <p>Touch 'n Go</p>
                            </div>
                            <div class="ewallet-option">
                                <i class="fas fa-qrcode"></i>
                                <p>GrabPay</p>
                            </div>
                        </div>
                        <p class="payment-note">A QR code will be provided after order confirmation</p>
                    </div>
                </div>
            </div>
            
            <!-- MAC Address Section -->
            <div class="mac-address-section">
                <h3>Device Verification</h3>
                <p>Please enter your device's MAC address for DRM verification:</p>
                <input type="text" placeholder="Enter MAC Address (XX:XX:XX:XX:XX:XX)" ng-model="macAddress">
                
                <div class="instruction-buttons">
                    <button class="btn-instruction" ng-click="showInstructions('desktop')">
                        <i class="fa fa-laptop"></i> Desktop Instruction
                    </button>
                    <button class="btn-instruction" ng-click="showInstructions('mobile')">
                        <i class="fa fa-mobile-alt"></i> Mobile Instruction
                    </button>
                </div>
            </div>
            
            <!-- Place Order Button -->
            <div class="order-actions">
                <button class="btn-place-order" ng-click="placeOrder()">
                    Place Order
                </button>
            </div>
        </section>
        
        <!-- Modal for Instructions -->
        <div class="modal" ng-if="showInstructionModal">
            <div class="modal-content">
                <span class="close-modal" ng-click="closeInstructions()">&times;</span>
                <h3>{{ instructionType === 'desktop' ? 'Desktop MAC Address Instructions' : 'Mobile MAC Address Instructions' }}</h3>
                
                <div class="instruction-steps" ng-if="instructionType === 'desktop'">
                    <p>To find your MAC address on Windows:</p>
                    <ol>
                        <li>Press <strong>Win + R</strong> to open Run dialog</li>
                        <li>Type <strong>cmd</strong> and press Enter</li>
                        <li>In the command prompt, type <strong>ipconfig /all</strong> and press Enter</li>
                        <li>Look for "Physical Address" under your network adapter</li>
                    </ol>
                    
                    <p>To find your MAC address on Mac:</p>
                    <ol>
                        <li>Click the Apple menu and select System Preferences</li>
                        <li>Click Network</li>
                        <li>Select your connection (Wi-Fi or Ethernet) and click Advanced</li>
                        <li>Go to the Hardware tab</li>
                        <li>Your MAC Address is listed as "MAC Address"</li>
                    </ol>
                    
                    <div class="download-section">
                        <p>Alternatively, download our MAC reader tool:</p>
                        <a href="/uploads/apps/MACReader.exe" download class="btn-download">
                            <i class="fa fa-download"></i> Download Desktop MacReader
                        </a>
                    </div>
                </div>
                
                <div class="instruction-steps" ng-if="instructionType === 'mobile'">
                    <p>To find your MAC address on Android:</p>
                    <ol>
                        <li>Go to <strong>Settings</strong></li>
                        <li>Tap on <strong>About Phone</strong></li>
                        <li>Tap on <strong>Status</strong> or <strong>Hardware Information</strong></li>
                        <li>Look for "Wi-Fi MAC address" or "WLAN MAC Address"</li>
                    </ol>
                    
                    <p>To find your MAC address on iOS:</p>
                    <ol>
                        <li>Go to <strong>Settings</strong></li>
                        <li>Tap on <strong>General</strong></li>
                        <li>Tap on <strong>About</strong></li>
                        <li>Look for "Wi-Fi Address"</li>
                    </ol>
                    
                    <div class="download-section">
                        <p>Alternatively, download our MAC reader app:</p>
                        <a href="/uploads/apps/MACReader.apk" download class="btn-download">
                            <i class="fa fa-download"></i> Download Mobile MacReader
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>&copy; 2025 UTMeBook. All rights reserved.</p>
            </div>
        </footer>
    </div>
</body>
</html>